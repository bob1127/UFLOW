"use client";

import { useEffect, useRef } from "react";
import gsap from "gsap";

export default function LogoPreloader({ onFinish }) {
  const svgRef = useRef(null);

  useEffect(() => {
    const paths = svgRef.current.querySelectorAll("path");

    // 初始設定：描邊+無填色
    paths.forEach((path) => {
      const length = path.getTotalLength();
      gsap.set(path, {
        strokeDasharray: length,
        strokeDashoffset: length,
        stroke: "#000",
        fill: "none",
      });
    });

    // 描邊動畫
    const timeline = gsap.timeline({
      defaults: { ease: "power2.out" },
    });

    timeline.to(
      paths,
      {
        strokeDashoffset: 0,
        duration: 1.5,
        stagger: 0.03,
      },
      0
    );

    // 填色動畫（延遲填滿）
    timeline.to(
      paths,
      {
        fill: "#000",
        duration: 0.8,
        stagger: 0.02,
      },
      "fill"
    );

    // 最後淡出整個畫面
    timeline.to(
      svgRef.current,
      {
        opacity: 0,
        duration: 0.8,
        delay: 0.5,
        onComplete: () => {
          if (onFinish) onFinish();
        },
      },
      "fill+=0.8" // 填色結束後再淡出
    );
  }, [onFinish]);

  return (
    <div className="fixed inset-0 bg-white z-[9999] flex items-center justify-center">
      <svg
        ref={svgRef}
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 300 299"
        className="w-[200px] h-[200px]"
      >
        {/* your paths remain unchanged */}
        {/* 👇👇👇 放你原來的 <g> 與 <path> 結構即可 */}
        <g
          transform="translate(0.000000,299.000000) scale(0.100000,-0.100000)"
          fill="#000000"
          stroke="none"
        >
          <path
            d="M5 1495 c0 -825 1 -1161 2 -747 2 415 2 1090 0 1500 -1 411 -2 72 -2
-753z"
          />
          <path
            d="M2995 1495 c0 -825 1 -1161 2 -747 2 415 2 1090 0 1500 -1 411 -2 72
-2 -753z"
          />
          <path
            d="M1375 2426 l-240 -113 -40 19 -40 20 -185 -86 -185 -85 -2 -361 -1
-362 -139 -1 c-122 -2 -138 -4 -141 -19 -3 -17 53 -18 1073 -18 978 0 1077 1
1071 16 -3 9 -6 18 -6 20 0 3 -62 4 -137 3 l-138 -1 -5 396 -5 396 -135 64
c-390 182 -486 226 -495 225 -5 0 -118 -51 -250 -113z m235 -135 l0 -199 -197
92 c-109 51 -207 96 -218 100 -20 8 -8 14 170 95 28 12 91 42 140 66 50 24 93
44 98 44 4 1 7 -89 7 -198z m120 164 c41 -20 169 -80 283 -133 l208 -98 0
-382 0 -383 -286 0 -285 0 -3 516 c-1 283 0 515 3 515 3 0 39 -16 80 -35z
m-690 -203 l0 -47 -151 -70 c-83 -39 -155 -71 -160 -73 -5 -2 -9 18 -9 45 l0
50 153 71 c83 39 155 71 160 71 4 1 7 -20 7 -47z m296 -72 c141 -66 260 -120
265 -120 5 0 9 -133 9 -302 l0 -303 -267 2 -268 3 -3 420 c-1 231 0 420 3 420
2 0 120 -54 261 -120z m-296 -43 l0 -43 -151 -70 c-84 -38 -156 -70 -160 -72
-5 -2 -9 16 -9 40 l0 43 78 33 c42 19 111 51 152 72 41 21 78 38 83 39 4 0 7
-18 7 -42z m0 -111 c0 -41 -2 -45 -37 -59 -21 -8 -90 -40 -154 -71 -63 -31
-118 -56 -122 -56 -4 0 -7 20 -7 45 0 25 4 45 10 45 12 0 189 81 250 115 25
13 48 25 53 25 4 0 7 -20 7 -44z m0 -111 c0 -34 -4 -47 -17 -52 -10 -3 -81
-34 -157 -69 -77 -35 -141 -64 -143 -64 -1 0 -3 18 -3 40 l0 40 103 47 c56 26
125 60 152 74 28 14 53 27 58 28 4 0 7 -19 7 -44z m0 -108 l0 -44 -147 -67
c-82 -38 -154 -70 -160 -73 -9 -4 -13 7 -13 36 l0 41 118 55 c64 30 133 63
152 74 49 27 50 26 50 -22z m0 -112 c0 -39 -3 -47 -24 -55 -26 -10 -123 -54
-220 -101 -33 -16 -63 -29 -68 -29 -4 0 -8 18 -8 40 l0 40 103 47 c56 26 125
60 152 74 28 14 53 27 58 28 4 0 7 -19 7 -44z m0 -109 l0 -44 -83 -39 c-68
-33 -97 -41 -160 -45 -114 -7 -99 12 68 89 77 35 144 68 150 74 18 18 25 8 25
-35z m-2 -102 c-3 -24 -7 -26 -65 -29 -35 -2 -63 -2 -63 1 0 6 102 52 118 53
9 1 12 -8 10 -25z"
          />
          <path
            d="M1499 1286 c-2 -2 -3 -92 -1 -200 3 -187 4 -196 22 -196 17 0 20 7
20 48 0 35 5 54 18 65 17 16 21 13 66 -48 40 -54 52 -65 77 -65 l29 0 -64 83
-65 83 57 57 57 57 -30 0 c-24 0 -41 -12 -88 -62 l-57 -63 2 123 c3 118 2 122
-18 122 -11 0 -23 -2 -25 -4z"
          />
          <path
            d="M2330 1090 l0 -200 25 0 25 0 0 103 c0 87 3 106 18 119 26 23 50 28
77 18 25 -9 25 -11 25 -125 l0 -115 25 0 25 0 0 114 c0 98 -3 117 -20 139 -28
36 -64 42 -111 19 l-39 -19 0 73 c0 72 -1 74 -25 74 l-25 0 0 -200z"
          />
          <path
            d="M315 1080 l0 -190 26 0 c25 0 25 1 21 60 -4 52 -1 63 21 90 l25 30
69 -90 c57 -75 73 -90 96 -90 27 0 36 13 17 25 -5 3 -41 47 -79 96 l-71 91 75
82 c74 79 75 81 48 84 -21 3 -35 -4 -57 -30 -16 -18 -56 -62 -88 -98 l-59 -65
3 98 3 97 -25 0 -25 0 0 -190z"
          />
          <path
            d="M2624 1255 c-4 -9 -2 -21 4 -27 16 -16 47 -5 47 17 0 26 -42 34 -51
10z"
          />
          <path
            d="M980 1169 c-35 -14 -60 -39 -60 -61 0 -26 29 -22 56 7 39 42 95 28
108 -27 6 -27 5 -28 -39 -28 -114 0 -175 -81 -110 -145 29 -30 104 -35 125
-10 7 8 16 15 21 15 5 0 9 -7 9 -15 0 -9 9 -15 23 -15 22 0 22 1 19 113 -3 61
-9 120 -14 130 -10 20 -67 47 -95 46 -10 0 -29 -5 -43 -10z m102 -174 c-5 -42
-29 -65 -67 -65 -38 0 -58 20 -53 52 4 29 43 49 88 46 33 -3 35 -5 32 -33z"
          />
          <path
            d="M1287 1161 c-29 -15 -37 -16 -37 -5 0 8 -10 14 -25 14 l-25 0 0 -140
0 -140 25 0 25 0 0 103 c0 117 12 140 72 140 51 0 60 -23 56 -141 -3 -100 -3
-102 20 -102 22 0 22 2 22 118 -1 126 -6 143 -54 162 -36 13 -36 13 -79 -9z"
          />
          <path
            d="M1834 1166 c-91 -41 -112 -170 -39 -243 27 -27 40 -33 76 -33 85 0
131 50 131 139 -1 108 -83 175 -168 137z m92 -50 c24 -20 28 -31 28 -78 1 -75
-21 -108 -74 -108 -53 0 -80 34 -80 102 0 41 5 54 29 79 36 35 61 37 97 5z"
          />
          <path
            d="M2123 1169 c-54 -16 -79 -73 -50 -113 7 -9 42 -27 77 -40 60 -20 65
-24 65 -51 0 -29 -1 -30 -50 -30 -42 0 -52 3 -60 23 -6 13 -18 22 -32 22 -32
0 -29 -25 6 -61 24 -24 38 -29 76 -29 51 0 99 20 109 45 21 56 -10 94 -100
120 -46 13 -54 19 -54 40 0 47 57 59 96 20 27 -27 64 -34 64 -11 0 16 -48 66
-64 66 -6 0 -20 2 -31 4 -11 3 -34 0 -52 -5z"
          />
          <path
            d="M630 1055 c0 -110 1 -117 25 -140 29 -30 98 -35 127 -8 17 15 18 15
18 0 0 -11 8 -17 25 -17 l25 0 0 140 0 140 -25 0 -25 0 0 -103 c0 -116 -10
-137 -66 -137 -48 0 -54 14 -54 132 l0 108 -25 0 -25 0 0 -115z"
          />
          <path
            d="M2625 1030 c0 -139 0 -140 23 -140 22 0 22 1 22 140 0 139 0 140 -22
140 -23 0 -23 -1 -23 -140z"
          />
        </g>
      </svg>
    </div>
  );
}
